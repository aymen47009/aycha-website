<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>🌟 صفحتي الدراسية</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/css2?family=Cairo&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">

  <style>
    body {
      font-family: 'Cairo', sans-serif;
      background-color: #fefafc;
      margin: 0;
      padding: 20px;
      color: #4a004a;
    }

    h1 {
      text-align: center;
      color: #a0007a;
    }

    .section {
      background-color: #fff0fa;
      padding: 20px;
      margin-bottom: 40px;
      border-radius: 15px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    .section h2 {
      color: #7a007a;
    }

    label {
      font-weight: bold;
      margin-top: 10px;
      display: block;
    }

    input, textarea {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      border-radius: 8px;
      border: 1px solid #ddd;
      font-size: 16px;
    }

    button {
      margin-top: 15px;
      background-color: #e7aaff;
      padding: 10px 20px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
    }

    button:hover {
      background-color: #d98de5;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }

    th, td {
      border: 1px solid #ddd;
      padding: 10px;
      text-align: center;
    }

    th {
      background-color: #fbd6ff;
    }
  </style>
</head>
<body>

  <h1>🌟 صفحتي الدراسية - عائشة</h1>

  <!-- 📘 القسم 1: جدول الواجبات المدرسية -->
  <div class="section">
    <h2>📘 واجباتي المدرسية</h2>
    <label>📚 المادة:</label>
    <input type="text" id="subject" placeholder="مثال: رياضيات" />

    <label>📄 رقم الصفحة:</label>
    <input type="text" id="page" placeholder="مثال: 32" />

    <label>✏️ رقم التمرين:</label>
    <input type="text" id="exercise" placeholder="مثال: 3" />

    <label>📅 تاريخ الإنجاز:</label>
    <input type="date" id="hwDate" lang="en" style="direction: ltr;" />

    <label>🏠 مكان الإنجاز:</label>
    <input type="text" id="place" placeholder="مثال: في البيت / في المدرسة" />

    <button onclick="saveHomework()">💾 حفظ الواجب</button>
    <p id="hwStatus"></p>
    <div id="homeworkList"></div>
  </div>

  <!-- 📖 القسم 2: جدول حفظ القرآن -->
  <div class="section">
    <h2>📖 جدول حفظ القرآن الكريم</h2>
    <label>📅 اليوم:</label>
    <input id="quranDay" placeholder="اختاري اليوم" />

    <label>🕋 السورة:</label>
    <input type="text" id="quranSurah" />

    <label>من الآية:</label>
    <input type="text" id="quranFrom" />

    <label>إلى الآية:</label>
    <input type="text" id="quranTo" />

    <label>ملاحظة:</label>
    <textarea id="quranNote"></textarea>

    <button onclick="saveQuran()">💾 حفظ الحفظ</button>
    <p id="quranStatus"></p>
    <div id="quranList"></div>
  </div>

  <!-- Flatpickr -->
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js';
    import {
      getFirestore, collection, addDoc, getDocs,
      query, orderBy, Timestamp, deleteDoc, doc
    } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js';

    const firebaseConfig = {
      apiKey: "AIzaSyDK3CqwJEB6uG8npPCG6jQqzqkUbI6vjJs",
      authDomain: "aycha-website.firebaseapp.com",
      projectId: "aycha-website",
      storageBucket: "aycha-website.appspot.com",
      messagingSenderId: "488063935676",
      appId: "1:488063935676:web:8a6450edd804d711db5cb9"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // التقويم للسورة
    flatpickr("#quranDay", {
      dateFormat: "Y-m-d",
      locale: "en"
    });

    // ✅ كود جدول الواجبات
    window.saveHomework = async function () {
      const subject = document.getElementById("subject").value.trim();
      const page = document.getElementById("page").value.trim();
      const exercise = document.getElementById("exercise").value.trim();
      const date = document.getElementById("hwDate").value;
      const place = document.getElementById("place").value.trim();
      const status = document.getElementById("hwStatus");

      if (!subject || !page || !exercise || !date || !place) {
        status.textContent = "❌ الرجاء ملء جميع الحقول.";
        status.style.color = "red";
        return;
      }

      try {
        await addDoc(collection(db, "profile", "aycha", "homework"), {
          subject, page, exercise, date, place, createdAt: Timestamp.now()
        });
        status.textContent = "✔ تم حفظ الواجب!";
        status.style.color = "green";
        showHomework();
      } catch (err) {
        console.error(err);
        status.textContent = "❌ خطأ في الحفظ.";
        status.style.color = "red";
      }
    }

    async function showHomework() {
  const container = document.getElementById("homeworkList");
  container.innerHTML = "⏳ جاري التحميل...";
  const q = query(collection(db, "profile", "aycha", "homework"), orderBy("createdAt", "desc"));
  const snap = await getDocs(q);

  if (snap.empty) {
    container.innerHTML = "📭 لا توجد واجبات بعد.";
    return;
  }

  let html = `<table><tr><th>المادة</th><th>الصفحة</th><th>التمرين</th><th>التاريخ</th><th>المكان</th><th>❌ حذف</th></tr>`;
  snap.forEach(docSnap => {
    const d = docSnap.data();
    const id = docSnap.id;
    html += `<tr>
      <td>${d.subject}</td>
      <td>${d.page}</td>
      <td>${d.exercise}</td>
      <td>${d.date}</td>
      <td>${d.place}</td>
      <td><button onclick="deleteHomework('${id}')">🗑️</button></td>
    </tr>`;
  });
  html += "</table>";
  container.innerHTML = html;
}
 
window.deleteHomework = async function(id) {
  if (confirm("هل أنت متأكد أنك تريد حذف هذا الواجب؟")) {
    await deleteDoc(doc(db, "profile", "aycha", "homework", id));
    showHomework(); // تحديث الجدول بعد الحذف
  }
}


    // ✅ كود جدول الحفظ
    window.saveQuran = async function () {
      const day = document.getElementById("quranDay").value;
      const surah = document.getElementById("quranSurah").value.trim();
      const from = document.getElementById("quranFrom").value.trim();
      const to = document.getElementById("quranTo").value.trim();
      const note = document.getElementById("quranNote").value.trim();
      const status = document.getElementById("quranStatus");

      if (!day || !surah || !from || !to) {
        status.textContent = "❌ الرجاء ملء جميع الحقول.";
        status.style.color = "red";
        return;
      }

      try {
        await addDoc(collection(db, "profile", "aycha", "quran"), {
          day, surah, from, to, note, createdAt: Timestamp.now()
        });
        status.textContent = "✔ تم حفظ الحفظ!";
        status.style.color = "green";
        loadLastSurah();
        showQuran();
      } catch (err) {
        console.error(err);
        status.textContent = "❌ خطأ في الحفظ.";
        status.style.color = "red";
      }
    }

    async function loadLastSurah() {
      const q = query(collection(db, "profile", "aycha", "quran"), orderBy("createdAt", "desc"));
      const snap = await getDocs(q);
      if (!snap.empty) {
        const last = snap.docs[0].data();
        document.getElementById("quranSurah").value = last.surah;
      }
    }

    async function showQuran() {
  const container = document.getElementById("quranList");
  container.innerHTML = "⏳ جاري التحميل...";
  const q = query(collection(db, "profile", "aycha", "quran"), orderBy("createdAt", "desc"));
  const snap = await getDocs(q);

  if (snap.empty) {
    container.innerHTML = "📭 لا يوجد محفوظات.";
    return;
  }

  let html = `<table><tr><th>اليوم</th><th>السورة</th><th>من</th><th>إلى</th><th>ملاحظة</th><th>❌ حذف</th></tr>`;
  snap.forEach(docSnap => {
    const d = docSnap.data();
    const id = docSnap.id;
    html += `<tr>
      <td>${d.day}</td>
      <td>${d.surah}</td>
      <td>${d.from}</td>
      <td>${d.to}</td>
      <td>${d.note}</td>
      <td><button onclick="deleteQuran('${id}')">🗑️</button></td>
    </tr>`;
  });
  html += `</table>`;
  container.innerHTML = html;
}

window.deleteQuran = async function(id) {
  if (confirm("هل أنت متأكد أنك تريد حذف هذا الحفظ؟")) {
    await deleteDoc(doc(db, "profile", "aycha", "quran", id));
    showQuran(); // تحديث الجدول بعد الحذف
  }
}


    // تحميل البيانات عند فتح الصفحة
    showHomework();
    showQuran();
    loadLastSurah();
  </script>
</body>
</html>
